<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pohon Jariyah</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui}
body{background:#eef3f7;height:100vh;overflow:hidden}

/* ===== SCENE ===== */
#scene{
  height:60vh;
  background:linear-gradient(to top,#4CAF50,#90CAF9);
  display:flex;
  justify-content:center;
  align-items:flex-end;
  position:relative;
  transition:1s;
}

/* Wrapper untuk efek tumbuh */
.tree-wrapper{
  overflow:hidden;
  transition:1s ease;
  display:flex;
  align-items:flex-end;
  justify-content:center;
}

/* Gambar pohon */
.tree-img{
  width:320px;
  transition:1s ease;
  transform-origin:bottom center;
}

/* Glow milestone */
.glow{
  filter:drop-shadow(0 0 20px rgba(255,255,200,0.8));
}

/* Tanah */
.grass{
  position:absolute;
  bottom:0;
  width:100%;
  height:100px;
  background:#2E7D32;
}

/* ===== UI ===== */
.panel{
  height:40vh;
  background:white;
  border-radius:30px 30px 0 0;
  margin-top:-30px;
  padding:24px;
  text-align:center;
  box-shadow:0 -10px 25px rgba(0,0,0,.08);
}

.btn{
  width:100%;
  padding:16px;
  background:linear-gradient(to right,#4CAF50,#2E7D32);
  border:none;
  color:white;
  font-weight:700;
  border-radius:40px;
}
</style>
</head>

<body>

<div id="scene">
  <div class="tree-wrapper" id="treeWrapper">
    <img src="tree.png" id="treeImg" class="tree-img">
  </div>
  <div class="grass"></div>
</div>

<div class="panel">
  <h3>Pohon Jariyah</h3>
  <p>Total Sedekah</p>
  <h2>Rp <span id="total">0</span></h2>
  <br>
  <button class="btn" onclick="location.href='kartu.html'">ðŸ’§ Siram Sedekah</button>
</div>

<script>
function loadProgress(){
  let data = JSON.parse(localStorage.getItem('kas_data') || '[]');

  let total = 0;
  let count = 0;

  data.forEach(t=>{
    if(t.type === 'masuk'){
      total += parseInt(t.amount);
      count++;
    }
  });

  document.getElementById("total").innerText = total.toLocaleString();
  growTree(total, count);
}

function growTree(total, count){
  const tree = document.getElementById("treeImg");
  const wrapper = document.getElementById("treeWrapper");
  const scene = document.getElementById("scene");

  /* ===== 1. REVEAL HEIGHT (tumbuh dari bawah) ===== */
  let revealHeight = 120 + Math.sqrt(total)/2;
  if(revealHeight > 420) revealHeight = 420;
  wrapper.style.height = revealHeight + "px";

  /* ===== 2. SCALE HALUS ===== */
  let scale = 0.7 + Math.sqrt(total)/8000;
  if(scale > 1.15) scale = 1.15;
  tree.style.transform = `scale(${scale})`;

  /* ===== 3. KESEHATAN (brightness dari konsistensi) ===== */
  let health = Math.min(count*0.05, 0.4);
  tree.style.filter = `brightness(${0.85 + health})`;

  /* ===== 4. LEVEL ENVIRONMENT ===== */
  if(total > 10000000){
    scene.style.background="linear-gradient(to top,#1B5E20,#FFD54F)";
    tree.classList.add("glow");
  } 
  else if(total > 3000000){
    scene.style.background="linear-gradient(to top,#2E7D32,#90CAF9)";
    tree.classList.remove("glow");
  } 
  else{
    scene.style.background="linear-gradient(to top,#4CAF50,#90CAF9)";
    tree.classList.remove("glow");
  }
}

window.onload = loadProgress;
</script>

</body>
</html>
