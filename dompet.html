<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dompet Digital | Master Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <style>
        :root { --dana-blue: #108ee9; --bg-light: #f5f5f5; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: var(--bg-light); padding-bottom: 100px; }
        
        .header-dompet {
            background: var(--dana-blue);
            padding: 30px 20px 60px;
            color: white;
            text-align: center;
            border-radius: 0 0 30px 30px;
        }

        .main-container { padding: 0 15px; margin-top: -40px; }

        .card-crypto {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .label-crypto {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
        }

        .price-up { color: #10b981; font-size: 24px; font-weight: 800; margin: 5px 0; }
        
        #chart-canvas { min-height: 250px; margin-top: 15px; }

        .btn-back {
            position: absolute; top: 20px; left: 20px; color: white; font-size: 20px;
        }
    </style>
</head>
<body>

    <div class="header-dompet">
        <a href="index.html" class="btn-back"><i class="fas fa-arrow-left"></i></a>
        <p style="opacity: 0.8; font-size: 14px;">Total Asset Value</p>
        <h1 id="total-saldo">Rp 0</h1>
    </div>

    <div class="main-container">
        <div class="card-crypto">
            <div class="label-crypto">
                <span>Market Analysis (IDR/KAS)</span>
                <span style="color: #10b981;"><i class="fas fa-caret-up"></i> Live</span>
            </div>
            <div class="price-up" id="current-price">Rp 0</div>
            
            <div id="chart-canvas"></div>
        </div>

        <div class="card-crypto" style="display: flex; justify-content: space-around; text-align: center;">
            <div>
                <p style="font-size: 11px; color: #888;">24h High</p>
                <p style="font-size: 14px; font-weight: 700; color: #10b981;" id="high-val">0</p>
            </div>
            <div>
                <p style="font-size: 11px; color: #888;">24h Low</p>
                <p style="font-size: 14px; font-weight: 700; color: #ef4444;" id="low-val">0</p>
            </div>
            <div>
                <p style="font-size: 11px; color: #888;">Volume</p>
                <p style="font-size: 14px; font-weight: 700;" id="vol-val">0</p>
            </div>
        </div>
    </div>

    <script>
        // 1. Ambil Data dari Infaq.html (Localstorage)
        function getLedgerData() {
            const dataRaw = localStorage.getItem('kas_ledger');
            return dataRaw ? JSON.parse(dataRaw) : [];
        }

        function renderCryptoChart() {
            const transactions = getLedgerData();
            let currentBalance = 0;
            let chartData = [];
            let prices = [];

            // Proses data untuk grafik (Area Chart ala Crypto)
            transactions.forEach((t, index) => {
                let nominal = parseInt(t.nominal) || 0;
                if(t.tipe === 'masuk') currentBalance += nominal;
                else currentBalance -= nominal;
                
                prices.push(currentBalance);
                chartData.push({
                    x: t.tanggal || new Date().getTime(),
                    y: currentBalance
                });
            });

            // Update UI Angka
            document.getElementById('total-saldo').innerText = "Rp " + currentBalance.toLocaleString('id-ID');
            document.getElementById('current-price').innerText = "Rp " + currentBalance.toLocaleString('id-ID');
            document.getElementById('high-val').innerText = Math.max(...prices, 0).toLocaleString('id-ID');
            document.getElementById('low-val').innerText = Math.min(...prices, 0).toLocaleString('id-ID');
            document.getElementById('vol-val').innerText = transactions.length;

            // 2. Konfigurasi Grafik ApexCharts
            var options = {
                series: [{
                    name: 'Saldo Kas',
                    data: prices // Data pergerakan saldo
                }],
                chart: {
                    type: 'area',
                    height: 250,
                    toolbar: { show: false },
                    zoom: { enabled: false },
                    sparkline: { enabled: false }
                },
                colors: ['#108ee9'],
                dataLabels: { enabled: false },
                stroke: { curve: 'smooth', width: 3 },
                fill: {
                    type: 'gradient',
                    gradient: {
                        shadeIntensity: 1,
                        opacityFrom: 0.6,
                        opacityTo: 0.1,
                    }
                },
                xaxis: {
                    labels: { show: false },
                    axisBorder: { show: false }
                },
                yaxis: {
                    labels: { style: { colors: '#888' } }
                },
                grid: {
                    borderColor: '#f1f1f1',
                    strokeDashArray: 4
                }
            };

            var chart = new ApexCharts(document.querySelector("#chart-canvas"), options);
            chart.render();
        }

        window.onload = renderCryptoChart;
    </script>
</body>
</html>
