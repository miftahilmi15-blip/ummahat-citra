<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pohon Jariyah</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui}
body{background:#eef3f7;height:100vh;overflow:hidden}

/* ===== SCENE ===== */
#scene{
  height:55vh;
  background:linear-gradient(to top,#4CAF50,#90CAF9);
  display:flex;
  justify-content:center;
  align-items:flex-end;
  position:relative;
  overflow:hidden;
  transition:1s;
  padding-top:20px;
}

/* ===== TREE ===== */
.tree-wrapper{
  height:260px;                /* START KECIL */
  overflow:hidden;             /* CROP BAWAH */
  display:flex;
  justify-content:center;
  align-items:flex-end;
  transition:1s ease;
  z-index:2;
}

.tree-img{
  width:65%;                   /* UKURAN AWAL KECIL */
  max-width:240px;
  transform-origin:bottom center;
  transition:transform .8s cubic-bezier(.22,1,.36,1), filter .6s;
}

/* Glow milestone */
.tree-glow{
  filter:drop-shadow(0 0 18px rgba(255,255,200,0.9));
}

/* ===== PARTICLE LIGHT ===== */
.light{
  position:absolute;
  bottom:0;
  width:6px;
  height:6px;
  background:rgba(255,255,255,.7);
  border-radius:50%;
  animation:floatUp 2s ease forwards;
}
@keyframes floatUp{
  to{transform:translateY(-140px);opacity:0}
}

/* ===== UI ===== */
.panel{
  height:45vh;
  background:white;
  border-radius:30px 30px 0 0;
  margin-top:-30px;
  padding:24px;
  text-align:center;
  box-shadow:0 -10px 25px rgba(0,0,0,.08);
}

.btn{
  width:100%;
  padding:16px;
  background:linear-gradient(to right,#4CAF50,#2E7D32);
  border:none;
  color:white;
  font-weight:700;
  border-radius:40px;
  margin-top:16px;
}

/* Milestone text */
#milestone{
  position:absolute;
  bottom:130px;
  color:white;
  font-weight:600;
  opacity:0;
  transition:.6s;
  z-index:3;
}
</style>
</head>

<body>

<div id="scene">
  <div class="tree-wrapper" id="treeWrapper">
    <img src="tree.png" id="treeImg" class="tree-img">
  </div>
  <div id="milestone"></div>
</div>

<div class="panel">
  <h3>Pohon Jariyah</h3>
  <p>Total Sedekah</p>
  <h2>Rp <span id="total">0</span></h2>
  <button class="btn" onclick="location.href='kartu.html'">ðŸ’§ Siram Sedekah</button>
</div>

<script>
function loadProgress(){
  let data = JSON.parse(localStorage.getItem('kas_data') || '[]');

  let total = 0;
  let count = 0;

  data.forEach(t=>{
    if(t.type === 'masuk'){
      total += parseInt(t.amount);
      count++;
    }
  });

  document.getElementById("total").innerText = total.toLocaleString();
  growTree(total, count);
}

/* ===== CORE GROWTH ===== */
function growTree(total, count){
  applyScaling(total);
  applyReveal(total);
  applyHealth(count);
  applyMilestone(total);
  spawnLight();
}

/* ===== 1. SCALING DINAMIS + BOUNCE ===== */
function applyScaling(total){
  const tree = document.getElementById("treeImg");

  let scale = 0.6 + Math.log10(total + 1) * 0.15;
  scale = Math.min(Math.max(scale,0.6),1.2);

  tree.style.transform = `scale(${scale + 0.05})`;
  setTimeout(()=>{
    tree.style.transform = `scale(${scale})`;
  },180);
}

/* ===== 2. REVEAL DARI BAWAH ===== */
function applyReveal(total){
  const wrapper = document.getElementById("treeWrapper");
  let h = 160 + Math.sqrt(total)/2;
  if(h > 360) h = 360;
  wrapper.style.height = h + "px";
}

/* ===== 3. KESEHATAN (KONSISTENSI) ===== */
function applyHealth(count){
  const tree = document.getElementById("treeImg");
  let health = Math.min(count * 0.05, 0.4);
  tree.style.filter = `brightness(${0.85 + health})`;
}

/* ===== 4. MILESTONE & ENVIRONMENT ===== */
function applyMilestone(total){
  const scene = document.getElementById("scene");
  const tree  = document.getElementById("treeImg");
  const text  = document.getElementById("milestone");

  tree.classList.remove("tree-glow");

  if(total >= 10000000){
    scene.style.background="linear-gradient(to top,#1B5E20,#FFD54F)";
    tree.classList.add("tree-glow");
    showText("Kebaikanmu menjadi berkah âœ¨");
  }
  else if(total >= 5000000){
    scene.style.background="linear-gradient(to top,#2E7D32,#90CAF9)";
    showText("Pohonmu semakin memberi manfaat ðŸŒ³");
  }
  else if(total >= 1000000){
    showText("Sedekahmu mulai menumbuhkan kebaikan ðŸŒ±");
  }
  else{
    scene.style.background="linear-gradient(to top,#4CAF50,#90CAF9)";
  }
}

function showText(msg){
  const el = document.getElementById("milestone");
  el.innerText = msg;
  el.style.opacity = 1;
  setTimeout(()=>el.style.opacity=0,1500);
}

/* ===== 5. PARTIKEL CAHAYA ===== */
function spawnLight(){
  const scene = document.getElementById("scene");
  const p = document.createElement("div");
  p.className="light";
  p.style.left=Math.random()*100+"%";
  scene.appendChild(p);
  setTimeout(()=>p.remove(),2000);
}

window.onload = loadProgress;
</script>

</body>
</html>
