<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaldik E-Santri Auto-API</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root {
            --primary: #108ee9; /* DANA BLUE */
            --bg: #121212;      /* DARK MODE */
            --card: #1e1e1e;
            --holiday: #ef5350; /* RED */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: var(--bg); color: #e0e0e0; padding-bottom: 30px; }

        header { 
            background: var(--card); padding: 25px 20px; text-align: center; 
            border-bottom: 1px solid #333; border-radius: 0 0 30px 30px;
        }

        .back-btn { position: absolute; top: 30px; left: 20px; color: var(--primary); font-size: 18px; text-decoration: none; }
        .title-4d { font-family: 'Montserrat', sans-serif; font-size: 20px; font-weight: 900; color: #fff; }

        main { max-width: 420px; margin: 20px auto; padding: 0 15px; }

        .month-selector { 
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 20px; background: var(--card); padding: 12px; 
            border-radius: 15px; border: 1px solid #333;
        }

        .month-selector button { 
            background: var(--primary); color: #fff; border: none; 
            padding: 8px 15px; border-radius: 10px; cursor: pointer; 
        }

        .calendar { 
            display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; 
            background: var(--card); padding: 15px; border-radius: 20px; border: 1px solid #333;
        }

        .day-name { text-align: center; font-weight: 700; font-size: 11px; color: var(--primary); text-transform: uppercase; padding-bottom: 10px; }

        .day { 
            aspect-ratio: 1/1; display: flex; flex-direction: column; align-items: center; 
            justify-content: center; background: #2b2b2b; border-radius: 12px; 
            font-size: 14px; font-weight: 700; cursor: pointer; position: relative;
        }

        .day .hijri { font-size: 8px; font-weight: 400; color: #888; margin-top: 2px; }
        
        /* Focus Hari Ini */
        .day.today { border: 2px solid var(--primary); background: rgba(16, 142, 233, 0.1); }
        .day.today::after { content: 'HARI INI'; position: absolute; top: -10px; font-size: 7px; background: var(--primary); color: #fff; padding: 1px 4px; border-radius: 4px; }

        .day.holiday { color: var(--holiday); }
        .day.holiday .hijri { color: var(--holiday); opacity: 0.6; }

        .legend { margin-top: 20px; display: flex; justify-content: center; gap: 15px; font-size: 11px; color: #888; }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .dot { width: 8px; height: 8px; border-radius: 50%; }

        /* Popup */
        #event-popup { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.8); backdrop-filter: blur(4px); justify-content: center; align-items: center; z-index: 999; 
        }
        .popup-content { background: var(--card); padding: 25px; border-radius: 24px; width: 85%; max-width: 350px; text-align: center; border: 1px solid #444; }
        .close-btn { background: var(--primary); color: #fff; border: none; padding: 12px; width: 100%; border-radius: 12px; font-weight: 700; margin-top: 15px; cursor: pointer; }
    </style>
</head>
<body>

<header>
    <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i></a>
    <h1 class="title-4d">KALENDER NASIONAL</h1>
</header>

<main>
    <div class="month-selector">
        <button id="prevMonth"><i class="fas fa-chevron-left"></i></button>
        <span id="monthYear">...</span>
        <button id="nextMonth"><i class="fas fa-chevron-right"></i></button>
    </div>

    <div class="calendar" id="calendar"></div>

    <div class="legend">
        <div class="legend-item"><div class="dot" style="background:var(--holiday)"></div> Hari Libur / Minggu</div>
        <div class="legend-item"><div class="dot" style="background:#888"></div> Tanggal Hijriyah</div>
    </div>
</main>

<div id="event-popup">
    <div class="popup-content">
        <h3 id="popup-date" style="color:var(--primary)"></h3>
        <p id="popup-message" style="margin-top:10px"></p>
        <button class="close-btn" onclick="closePopup()">OK, MENGERTI</button>
    </div>
</div>

<script>
    let currentDate = new Date(); 
    let holidaysData = [];

    // Tembak API Libur Nasional
    async function getHolidays() {
        try {
            const year = currentDate.getFullYear();
            const res = await fetch(`https://dayoffapi.vercel.app/api?year=${year}`);
            holidaysData = await res.json();
            renderCalendar();
        } catch (e) {
            renderCalendar(); 
        }
    }

    // Fungsi Konversi Hijriyah Otomatis
    function toHijri(date) {
        return new Intl.DateTimeFormat('id-TN-u-ca-islamic-uma-nu-latn', {day:'numeric'}).format(date);
    }

    function renderCalendar() {
        const calendarEl = document.getElementById('calendar');
        const monthYearEl = document.getElementById('monthYear');
        calendarEl.innerHTML = '';

        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();

        monthYearEl.innerText = new Intl.DateTimeFormat('id-ID', { month: 'long', year: 'numeric' }).format(currentDate);

        // Header Hari
        ['Min','Sen','Sel','Rab','Kam','Jum','Sab'].forEach(h => {
            const div = document.createElement('div');
            div.className = 'day-name';
            div.innerText = h;
            calendarEl.appendChild(div);
        });

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        for(let i=0; i<firstDay; i++) calendarEl.appendChild(document.createElement('div'));

        for(let d=1; d<=daysInMonth; d++) {
            const dateObj = new Date(year, month, d);
            const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
            
            const dayDiv = document.createElement('div');
            dayDiv.className = 'day';
            
            // Logic Hari Ini
            const realToday = new Date().toISOString().split('T')[0];
            if(dateStr === realToday) dayDiv.classList.add('today');

            // Cek Libur Nasional & Minggu
            const holiday = holidaysData.find(h => h.tanggal === dateStr);
            const isSunday = dateObj.getDay() === 0;

            if(isSunday || holiday) dayDiv.classList.add('holiday');

            dayDiv.innerHTML = `<span>${d}</span><span class="hijri">${toHijri(dateObj)}</span>`;
            
            dayDiv.onclick = () => {
                const hText = new Intl.DateTimeFormat('id-TN-u-ca-islamic-uma', {day:'numeric', month:'long', year:'numeric'}).format(dateObj);
                document.getElementById('popup-date').innerHTML = `${d} ${monthYearEl.innerText}<br><small style="color:#888">${hText} H</small>`;
                document.getElementById('popup-message').innerText = holiday ? holiday.keterangan : (isSunday ? "Libur Pekanan (Minggu)" : "Tidak ada hari libur nasional.");
                document.getElementById('event-popup').style.display = 'flex';
            };

            calendarEl.appendChild(dayDiv);
        }
    }

    function closePopup() { document.getElementById('event-popup').style.display = 'none'; }

    document.getElementById('prevMonth').onclick = () => { currentDate.setMonth(currentDate.getMonth()-1); getHolidays(); };
    document.getElementById('nextMonth').onclick = () => { currentDate.setMonth(currentDate.getMonth()+1); getHolidays(); };

    window.onload = getHolidays;
</script>
</body>
</html>
